var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r["throw"](e))}catch(t){a(t)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,a&&(i=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,a=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(i=c.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){c.label=n[1];break}if(6===n[0]&&c.label<i[1]){c.label=i[1],i=n;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(n);break}i[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],a=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,a,i,s,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__decorate=this&&this.__decorate||function(e,t,n,r){var o,a=arguments.length,i=3>a?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(3>a?o(i):a>3?o(t,n,i):o(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i},ServiceBase=function(){function e(){}return e.getInstance=function(e){var t=this.instanceMap.get(e);return t||(t=new(Function.prototype.bind.call(e,null)),this.instanceMap.set(e,t)),t},e.run=function(){[GameService].forEach(function(e){return e.instance})},e.onMessage=function(t,n,r){-1!==Object.keys(GameReturnOP).indexOf(""+t)&&e.instanceMap.forEach(function(e){return e.onMessage(t,n,r)})},e.getData=function(e,t){return bufferify.decode(2,e,t)},e.instanceMap=new Map,e}();__reflect(ServiceBase.prototype,"ServiceBase");var GameSendOP;!function(e){e[e.SEND_CHAT=111009]="SEND_CHAT"}(GameSendOP||(GameSendOP={}));var GameReturnOP;!function(e){e[e.RETURN_CHAT=111009]="RETURN_CHAT",e[e.RETURN_SEAT_INFO=112001]="RETURN_SEAT_INFO",e[e.RETURN_READY=112002]="RETURN_READY",e[e.RETURN_HAND=112003]="RETURN_HAND",e[e.RETURN_PLAY_SEAT=112005]="RETURN_PLAY_SEAT",e[e.RETURN_CALL=112006]="RETURN_CALL",e[e.RETURN_DO=112007]="RETURN_DO",e[e.RETURN_RESULT=112008]="RETURN_RESULT",e[e.RETURN_EXIT=112009]="RETURN_EXIT",e[e.RETURN_DISS=112010]="RETURN_DISS",e[e.RETURN_REPLY_DISS=112011]="RETURN_REPLY_DISS",e[e.RETURN_HOST=112012]="RETURN_HOST",e[e.RETURN_ONLINE=112013]="RETURN_ONLINE",e[e.RETURN_RECALL=112016]="RETURN_RECALL",e[e.RETURN_DOUBLE=112017]="RETURN_DOUBLE",e[e.RETURN_ROUND=112018]="RETURN_ROUND",e[e.RETURN_TS=112023]="RETURN_TS"}(GameReturnOP||(GameReturnOP={}));var SelfOP;!function(e){e[e.SELF_11_JOIN=111002]="SELF_11_JOIN",e[e.SELF_READY=111003]="SELF_READY",e[e.SELF_DO=111004]="SELF_DO",e[e.SELF_EXIT=111006]="SELF_EXIT",e[e.SELF_DISS=111007]="SELF_DISS",e[e.SELF_REPLY_DISS=111008]="SELF_REPLY_DISS",e[e.SELF_CALL=111010]="SELF_CALL",e[e.SELF_RECALL=111011]="SELF_RECALL",e[e.SELF_DOUBLE=111012]="SELF_DOUBLE"}(SelfOP||(SelfOP={}));var UIBase=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.getInstance=function(e){var t=this.instanceMap.get(e);return t||(t=new(Function.prototype.bind.call(e,null)),this.instanceMap.set(e,t)),t},t.instanceMap=new Map,t}(eui.Component);__reflect(UIBase.prototype,"UIBase",["eui.UIComponent","egret.DisplayObject"]);var component;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.canBack=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"elements",{get:function(){return this._elements},set:function(e){this._elements=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentWidth",{get:function(){return this._contentWidth},set:function(e){this._contentWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentHeight",{get:function(){return this._contentHeight},set:function(e){this._contentHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canBack",{get:function(){return this._canBack},set:function(e){this._canBack=e},enumerable:!0,configurable:!0}),t}(eui.Panel);e.PanelUI=t,__reflect(t.prototype,"component.PanelUI")}(component||(component={}));var PokerTsUI=function(e){function t(){var t=e.call(this)||this;return t.data={type:0,value:0},t.skinName="resource/eui_skins/component/PokerTsUI.exml",t}return __extends(t,e),t.prototype.setCard=function(e){this.data=e;var t="",n="";this.data.type>0?(t=""+this.data.type,n=""+(this.data.type%2===0?"h":"r")+this.data.value):n=""+(this.data.value%2===0?"h":"r")+this.data.value,this.value.source=n,this.type_m.source=t},t}(eui.Component);__reflect(PokerTsUI.prototype,"PokerTsUI");var Data;!function(e){var t;e.init=function(){e.room={aa:void 0,roomType:void 0,playSeat:void 0,playTime:void 0,changePlaySeatTime:void 0,round:void 0,totalRound:void 0,landlordSeat:void 0,landlordCard:[],lastPlayerSeat:void 0,lastPlayCard:{member:[],type:void 0},seatMap:[],balanceMap:[],dissolveMap:[]},e.hand=[],e.cheatList=[]},e.tick=function(n){e.time&&t&&(e.time=e.autoNotify(e.time,e.time+n-t,"Data.time").result),t=n},e.autoNotify=function(t,n,r,o){void 0===o&&(o=!0);var a,i=!1;return n instanceof Object?(r&&(a=e.copy(t)),t||(t=n instanceof Array?[]:{}),Object.keys(n).forEach(function(o){var a=e.autoNotify(t[o],n[o],r?r+"."+o:null);a.flag&&(t[o]=a.result,i=!0)}),t instanceof Array&&n instanceof Array&&t.length!==n.length&&(t=n,i=!0),r&&i&&Notify.sendNotification(Symbol["for"](r),o,t,a,r)):t!==n&&(a=t,t=n,i=!0,r&&Notify.sendNotification(Symbol["for"](r),o,t,a,r)),{result:t,flag:i}},e.copy=function(t){return e.autoNotify(null,t,null).result}}(Data||(Data={}));var MainUI=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.effectMap=new Map,t._fast={real:void 0,not:void 0},t.setVoice=function(e,n){e.forEach(function(e,t){return e.state=n>t?"dark":"light"}),t.voiceGroup.dataProvider.refresh()},t.startRecord=function(){if(!t.interval){var e=t.voiceGroup.dataProvider.source;t.setVoice(e,10),t.voiceGroup.parent.visible=!0,t.interval=Time.setInterval(function(){var n=e.findIndex(function(e){return"light"===e.state});t.setVoice(e,0===n||-1===n?10+n:n-1)},300),WeChat.startRecord()}},t.stopRecord=function(e){void 0===e&&(e=1),t.voiceGroup.parent.visible=!1,Time.clearInterval(t.interval),t.interval=null,WeChat.stopRecord(e)},t.playChat=function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return this.game.playChat(e),[2]})})},t.playEffect=function(e){return __awaiter(t,void 0,void 0,function(){var t,n,r,o,a,i=this;return __generator(this,function(s){switch(s.label){case 0:return t=this.effectMap.get(e),this.inEffect=!0,(n=!dragonBones.hasMovieGroup("effect"))?(o=(r=dragonBones).addMovieGroup,[4,RES.getResAsync("effect/effect_ske.dbmv")]):[3,3];case 1:return a=[s.sent()],[4,RES.getResAsync("effect/effect_tex.png")];case 2:n=o.apply(r,a.concat([s.sent()])),s.label=3;case 3:if(t)t.play(),t.visible=!0;else{switch(e){case"2":case"13":t=dragonBones.buildMovie(e),t.play("default",1);break;case"11":case"14":t=dragonBones.buildMovie(e),t.anchorOffsetX=-67,t.anchorOffsetY=-49,t.play("default",1);break;case"4":case"spring":case"gnirps":t=dragonBones.buildMovie("shine"),t.play(e,1)}t.addEventListener(dragonBones.MovieEvent.COMPLETE,function(){var e=!1;t.visible=!1,i.effectMap.forEach(function(t){return t.isPlaying&&(e=!0)}),i.inEffect=e},this),this.effectMap.set(e,t),this.effect.addChild(t)}return[2]}})})},t.init=function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.game.init(e)];case 1:return t.sent(),this.mode.text=Data.room.aa?"AA制":"房主付费",this.roomId.text=""+params.roomId,this.visible=!0,[2]}})})},t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.getInstance(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fast",{get:function(){return this._fast},set:function(e){this._fast.not=!(this._fast.real=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inEffect",{get:function(){return this._inEffect},set:function(e){this._inEffect=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"menuVisible",{get:function(){return this._menuVisible},set:function(e){this.menuGroup.touchEnabled=this.menuGroup.touchChildren=this._menuVisible=e,egret.Tween.removeTweens(this.menuGroup),e?egret.Tween.get(this.menuGroup).to({y:116},300,egret.Ease.backOut):egret.Tween.get(this.menuGroup).to({y:-378},300,egret.Ease.backIn)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"seat",{get:function(){return this.game.seat},set:function(e){this.game.seat=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playSeat",{get:function(){return this.game.playSeat},set:function(e){this.game.playSeat=e},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){var n=this;e.prototype.childrenCreated.call(this),Notify.addNotification(Symbol["for"]("Data.room.roomType"),function(e){return t.instance.fast=2===e}),Notify.addNotification(Symbol["for"]("Data.room.playTime"),function(e){return n.menuList.dataProvider.getItemAt(n.menuList.dataProvider.length-1).img="menu_"+(e?"dissolution":"back")}),Notify.addNotification(Symbol["for"]("Data.room.round"),function(e){return n.round.text=e+"/"+Data.room.totalRound}),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){n.game.touchTap(e),e.target!==n.menu&&(n.menuVisible=!1)},this),this.menu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return n.menuVisible=!n.menuVisible},this),this.setting.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return Main.instance.addChild(SettingDialogUI.instance)},this),this.chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return Main.instance.addChild(ChatDialogUI.instance)},this),this.menuList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){switch(e.target.itemIndex){case 0:ShareUI.instance.show("share");break;case 1:Main.instance.addChild(RuleDialogUI.instance);break;case 2:ShareUI.instance.show("top");break;case 3:Data.room.playTime?(DissolutionDialogUI.instance.currentState="confirm",Main.instance.addChild(DissolutionDialogUI.instance)):MessageDialogUI.instance.showConfirm("您确定要返回大厅吗？",function(){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Net.sendString(SelfOP.SELF_EXIT,{})];case 1:return e.sent().errorCode||Net.postMessage({forLobby:!0,cmd:"close"}),[2]}})})})}},this),this.voice.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){return n.startRecord()},this),this.voice.addEventListener(egret.TouchEvent.TOUCH_END,function(){return n.stopRecord()},this),this.voice.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){return n.stopRecord(0)},this),this.voice.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){return n.stopRecord()},this),this.voiceGroup.dataProvider=new eui.ArrayCollection(new Array(10).fill(null).map(function(e,t){return{width:15+7*(10-t)}}))},t}(UIBase);__reflect(MainUI.prototype,"MainUI");var ShareUI=function(e){function t(){var t=e.call(this)||this;return t.show=function(e){t.source="alone/"+e+".png",Main.instance.addChild(t)},t.addEventListener(egret.Event.ADDED_TO_STAGE,function(){egret.Tween.removeTweens(t),egret.Tween.removeTweens(t.main),t.alpha=0,t.main.scaleX=t.main.scaleY=0,egret.Tween.get(t).to({alpha:1},300,egret.Ease.backOut),egret.Tween.get(t.main).to({scaleX:1,scaleY:1},300,egret.Ease.backOut)},t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.getInstance(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._source},set:function(e){this._source=e},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.rect.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.flag||(t.flag=!0,egret.Tween.removeTweens(t),egret.Tween.removeTweens(t.main),egret.Tween.get(t).to({alpha:0},300,egret.Ease.backIn).call(function(){Main.instance.removeChild(t),WeChat.initShare(),t.flag=!1}),egret.Tween.get(t.main).to({scaleX:0,scaleY:0},300,egret.Ease.backIn))},this),egret.Tween.get(this.arrow,{loop:!0}).to({right:0,alpha:1},500).to({alpha:0},500)},t}(UIBase);__reflect(ShareUI.prototype,"ShareUI");var Main=function(e){function t(){var t=this;return n.instance||(n._instance=t=e.call(this)||this),n.instance}return __extends(t,e),n=t,Object.defineProperty(t,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t,"mcFactory",{get:function(){var e=this;return new Promise(function(t){return __awaiter(e,void 0,void 0,function(){var e,n;return __generator(this,function(r){switch(r.label){case 0:return this._mcFactory?[3,3]:(e=this,n=RES.getRes("movieclip/expression.json"),n?[3,2]:[4,RES.getResAsync("movieclip/expression.json")]);case 1:n=r.sent(),r.label=2;case 2:e._mcFactory=n,r.label=3;case 3:return t(this._mcFactory),[2]}})})})},enumerable:!0,configurable:!0}),t.prototype.createChildren=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,o=this;return __generator(this,function(a){switch(a.label){case 0:return e.prototype.createChildren.call(this),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},egret.registerImplementation("eui.IAssetAdapter",new Adapter.AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new Adapter.ThemeAdapter),RES.processor.map("version",new Processor.versionProcessor),RES.processor.map("sheet",new Processor.sheetProcessor),[4,RES.loadConfig()];case 1:return a.sent(),n=(t=Promise).all,r=[new Promise(function(e){return new eui.Theme("resource/default.thm.json",o.stage).addEventListener(egret.Event.COMPLETE,e,o)})],[4,RES.loadGroup("preload",0,{onProgress:function(e,t){return setProgress(e,t,!0)}})];case 2:return[4,n.apply(t,[r.concat([a.sent()])])];case 3:return a.sent(),function(){return __awaiter(o,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,Sound.play("sound/bgm.mp3",0,egret.Sound.MUSIC)];case 1:return t.sent(),this.once(egret.TouchEvent.TOUCH_BEGIN,function(){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,Sound.play("sound/bgm.mp3",1,egret.Sound.MUSIC)];case 1:return e=t.sent(),e.stop(),e.dispatchEvent(new egret.Event(egret.Event.SOUND_COMPLETE)),[2]}})})},this),[2]}})})}(),Time.run(),ServiceBase.run(),WeChat.initShare(),this.addChildAt(MainUI.instance,0),MainUI.instance.visible=!1,Net.postMessage({forLobby:!0,cmd:"ready"}),[2]}})})},t.res=new RES.Resource,t=n=__decorate([RES.mapConfig("config.json?v="+version,function(){return params.oss+"resource"},function(e){return["alone/","config/","sheet/","sound/","movieclip/","effect/"].some(function(t){return e.startsWith(t)})&&-1!==["jpg","png","webp","json","fnt","pvr","mp3","dbmv"].indexOf(e.substr(e.lastIndexOf(".")+1))?"version":""})],t);var n}(eui.UILayer);__reflect(Main.prototype,"Main");var component;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gray=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),t._bgTop=0,t._bgBottom=0,t._bgLeft=0,t._bgRight=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"bg",{get:function(){return this._bg},set:function(e){this._bg=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale9Grid",{get:function(){return this._scale9Grid},set:function(e){this._scale9Grid=egret.Rectangle.apply(new egret.Rectangle,e.split(",").map(function(e){return parseInt(e,10)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},set:function(e){this._size=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textColor",{get:function(){return this._textColor},set:function(e){this._textColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgTop",{get:function(){return this._bgTop},set:function(e){this._bgTop=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgBottom",{get:function(){return this._bgBottom},set:function(e){this._bgBottom=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgLeft",{get:function(){return this._bgLeft},set:function(e){this._bgLeft=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgRight",{get:function(){return this._bgRight},set:function(e){this._bgRight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ItemRenderer",{get:function(){for(var e=this;e;)if(e=e.parent,e instanceof eui.ItemRenderer)return e},enumerable:!0,configurable:!0}),t.prototype.getCurrentState=function(){var t=e.prototype.getCurrentState.call(this);return"disabled"===t?(this.alpha=.7,this.enabled=!1):(this.alpha=1,this.enabled=!0),t},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return Sound.play("sound/effect/button.mp3")},this)},t}(eui.Button);e.ButtonUI=t,__reflect(t.prototype,"component.ButtonUI")}(component||(component={}));var component;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},set:function(e){this._startTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(e){this._time=new eui.ArrayCollection((""+(void 0===e?"":e)).split(""))},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),Notify.addNotification(Symbol["for"]("Data.time"),function(e){if(t.startTime){var n=1-(e-t.startTime)/25e3;n>=0?t.time=Math.round(25*n):(t.time=0,t.startTime=0)}})},t}(eui.Component);e.CountUI=t,__reflect(t.prototype,"component.CountUI")}(component||(component={}));var component;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.forceClose=function(){var e=t.canClose;t.canClose=!0,t.close(),t.canClose=e},t.init=function(){t.flag=!1,egret.Tween.removeTweens(t),egret.Tween.removeTweens(t.main),t.alpha=0,t.main.scaleX=t.main.scaleY=0,egret.Tween.get(t).to({alpha:1},300,egret.Ease.backOut),egret.Tween.get(t.main).to({scaleX:1,scaleY:1},300,egret.Ease.backOut)},t.canBack=t.canClose=!0,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.init,t),t}return __extends(t,e),Object.defineProperty(t.prototype,"canClose",{get:function(){return this._canClose},set:function(e){this._canClose=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onClose",{get:function(){return this._onClose},set:function(e){this._onClose=e},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.rect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},t.prototype.close=function(){var e=this;!this.flag&&this.canClose&&(this.flag=!0,egret.Tween.removeTweens(this),egret.Tween.removeTweens(this.main),egret.Tween.get(this).to({alpha:0},300,egret.Ease.backIn).call(function(){Main.instance.removeChild(e.parent),e.onClose&&e.onClose(),e.flag=!1}),egret.Tween.get(this.main).to({scaleX:0,scaleY:0},300,egret.Ease.backIn))},t}(e.PanelUI);e.DialogUI=t,__reflect(t.prototype,"component.DialogUI")}(component||(component={}));var component;!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.betArr=[{key:"callLandlord",source0:"call",source1:"bj",opcode:SelfOP.SELF_CALL,"return":GameReturnOP.RETURN_CALL},{key:"grabLandlord",source0:"recall",source1:"bq",opcode:SelfOP.SELF_RECALL,"return":GameReturnOP.RETURN_RECALL},{key:"toDouble",source0:"double",source1:"bjb",opcode:SelfOP.SELF_DOUBLE,"return":GameReturnOP.RETURN_DOUBLE}],n.onPoker=function(e){e&&(n.selected=e.itemIndex,e.chosen=!e.chosen),n.selectedList=n.pokers.filter(function(e){return e.chosen}).map(function(e){return e.data}),n["do"].enabled=!!n.selectedList.length},n.doPoker=function(t){return __awaiter(n,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return[4,Net.sendString(SelfOP.SELF_DO,{list:t})];case 1:return n=r.sent(),n.errorCode?new e.ToastUI(n.errorCode===10*SelfOP.SELF_DO+3?"牌型不符合规则":"发生异常"):(Net.onmessage(new MessageEvent("custom",{data:{cmd:GameReturnOP.RETURN_HAND,hand:n.hand}})),Net.onmessage(new MessageEvent("custom",{data:{cmd:GameReturnOP.RETURN_DO,seat:this.seat.seat,segment:n.segment,handSize:n.hand.length}}))),[2]}})})},n.touchTap=function(t){t.target instanceof e.PokerItemUI||t.target===n.hint||(n.pokers.forEach(function(e){return e.chosen=!1}),n.onPoker())},n.playChat=function(e){return __awaiter(n,void 0,void 0,function(){var t;return __generator(this,function(n){return t=this.players.find(function(t){return t.index===e.seat}),void 0!==e.chat?t.playChat(e.chat):void 0!==e.expression?t.playExpression(e.expression):void 0!==e.serverId&&WeChat.downloadVoice(e.serverId),[2]})})},n.init=function(e){return __awaiter(n,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return this.currentState="waiting",this.mine.visible=this.mineTxt.visible=!1,this.players.forEach(function(e){e.dataProvider=null,e.txt=void 0}),this.isInit=!0,this.lastPlayer={seat:void 0,type:void 0},Data.init(),[4,Net.sendString(SelfOP.SELF_11_JOIN,{roleId:params.roleId,roomId:params.roomId,balance:!!e})];case 1:return t=n.sent(),t.errorCode?t.errorCode===10*SelfOP.SELF_11_JOIN+4?MessageDialogUI.instance.showAlert("余额不足，点击确定充值",function(){Net.postMessage({forLobby:!0,cmd:"recharge"})}):MessageDialogUI.instance.showAlert("发生异常，点击确定退出",function(){Net.postMessage({forLobby:!0,cmd:"close"})}):(t.room.seatMap=Object.keys(t.room.seatMap).map(function(e){return t.room.seatMap[e]}),t.room.balanceMap=Object.keys(t.room.balanceMap).map(function(e){return Object.assign({seat:parseInt(e,10)},t.room.balanceMap[e])}),t.room.dissolveMap=Object.keys(t.room.dissolveMap).map(function(e){return{seat:parseInt(e,10),agree:t.room.dissolveMap[e]}}),this.playSeat=t.room.playSeat,Data.autoNotify(Data.hand,t.hand,"Data.hand"),t.room.dissolveMap.length&&Net.onmessage(new MessageEvent("custom",{data:{cmd:GameReturnOP.RETURN_DISS,dissolveRoomTime:t.room.dissolveRoomTime}})),t.room.lastPlayerSeat&&Notify.sendNotification(Symbol["for"]("RETURN_DO"),!0,t.room.seatMap.find(function(e){return e.seat===t.room.lastPlayerSeat}).handSize),Data.autoNotify(Data.room,t.room,"Data.room")),[2]}})})},n}return __extends(n,t),Object.defineProperty(n.prototype,"seat",{get:function(){return this._seat},set:function(e){this._seat=e,this.lastTip=-1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"current",{get:function(){return this._current},set:function(e){var t=this;this._current=e,this.players.forEach(function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){var n=function(){void 0!==e.index&&(Notify.removeNotification(Symbol["for"]("Data.time"),n),t())};Notify.addNotification(Symbol["for"]("Data.time"),n)})];case 1:return t.sent(),e.index===this.current?(e.current=!0,e===this.me?this.mine.visible=this.mineTxt.visible=!1:(e.dataProvider=null,e.txt=void 0)):e.current=!1,[2]}})})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"playSeat",{get:function(){return this._playSeat},set:function(e){var t=this;this._playSeat=e,this.players.forEach(function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){var n=function(){void 0!==e.index&&(Notify.removeNotification(Symbol["for"]("Data.time"),n),t())};Notify.addNotification(Symbol["for"]("Data.time"),n)})];case 1:return t.sent(),(e===this.me?this:e).startTime=e.index===this.current?Data.room.changePlaySeatTime:0,[2]}})})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"startTime",{get:function(){return this._startTime},set:function(e){this._startTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bet",{get:function(){return this._bet},set:function(e){this._bet=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pokers",{get:function(){return this.poker.$children.filter(function(e){return e.visible})},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){var n=this;t.prototype.childrenCreated.call(this),Notify.addNotification(Symbol["for"]("Data.room.seatMap"),function(e){return __awaiter(n,void 0,void 0,function(){var t,n,r,o,a,i,s,c=this;return __generator(this,function(u){switch(u.label){case 0:return[4,new Promise(function(e){var t=function(){void 0!==Data.room.changePlaySeatTime&&(Notify.removeNotification(Symbol["for"]("Data.time"),t),e())};Notify.addNotification(Symbol["for"]("Data.time"),t)})];case 1:if(u.sent(),t=0,n=0,r=0,o=0,this.seat=Data.copy(e.find(function(e){return e.player.roleId===params.roleId})),this.seat.canTip=!!(this.seat.tip&&this.seat.tip.length&&this.seat.tip.some(function(e){return!Data.autoNotify(Data.copy(e.member.sort(function(e,t){return 10*e.value+e.type-(10*t.value+t.type)})),Data.hand.filter(function(t){return e.member.some(function(e){return e.type===t.type&&e.value===t.value})}).sort(function(e,t){return 10*e.value+e.type-(10*t.value+t.type)}),null).flag})),new Map([[this.me,this.seat],[this.leftPlayer,e.find(function(e){return e.seat===(1===c.seat.seat?3:c.seat.seat-1)})],[this.rightPlayer,e.find(function(e){return e.seat===(3===c.seat.seat?1:c.seat.seat+1)})]]).forEach(function(e,a){if(e){if(a.index=e.seat,a.head=e.player.headImgUrl,a.uname=e.player.nickname,a.score=e.score,a.sex=e.player.sex,a.host=e.landlord,a.count=e.handSize,a.offline=!e.player.active,Data.room.lastPlayerSeat)return;e.ready?(a===c.me&&(c.ready.icon="txt_cancel"),a.txt="txt_readyz",t++):(a===c.me&&(c.ready.icon="txt_ready"),a.txt=void 0),c.betArr.forEach(function(t,i){var s=e[t.key],u="txt_"+(1===s?t.source0:t.source1)+"z";if(s)switch(a===c.me?(c.mineTxt.source=u,c.mineTxt.visible=!0):a.txt=u,i){case 0:if(3===n||1===s&&(n=3))return;n++;break;case 1:if(3===r||2===Data.room.seatMap.filter(function(e){return 2===e.grabLandlord}).length&&(r=3))return;r++;break;case 2:if(3===o)return;o++}}),a.g_player.visible=!0,a.btn_invite.visible=!1}else a.txt=a.offline=a.count=a.host=a.sex=a.score=a.uname=a.head=a.index=void 0,a.g_player.visible=!1,a.btn_invite.visible=!0}),Data.room.lastPlayerSeat)return this.currentState="playing",[2];if(this.share.visible=!(this.waiting.visible=3===e.length),3===t?(this.currentState="betting",!Data.room.playTime&&Data.autoNotify(Data.room,{playTime:Data.time},"Data.room"),this.players.forEach(function(e){return"txt_readyz"===e.txt&&(e.txt=void 0)})):this.players.forEach(function(e){return e.count=void 0}),n){if(3===n)if(3===r)if(this.hole.visible=!0,3===o)for(this.currentState="playing",this.mineTxt.visible=!1,this.players.forEach(function(e){return e.txt=void 0}),i=Data.room.lastPlayerSeat;i&&(1===Data.room.playSeat?3:Data.room.playSeat-1)!==i;)i=3===i?1:i+1,s=this.players.find(function(e){return e.index===i}),i===this.seat.seat?(this.mineTxt.source="txt_bcz",this.mine.visible=!(this.mineTxt.visible=!0)):(s.txt="txt_bcz",s.dataProvider=null);else this.players.forEach(function(e){return e.count=void 0}),this.bet=this.betArr[2],a=Data.room.landlordSeat+o;else for(this.players.forEach(function(e){return e.count=void 0}),this.hole.visible=!1,this.bet=this.betArr[1],a=this.playSeat+r+(Data.room.seatMap.some(function(e){return 1===e.callLandlord})?1:0);2===Data.room.seatMap.find(function(e){return e.seat===(a>3?a-3:a)}).grabLandlord;)a++;else this.players.forEach(function(e){return e.count=void 0}),this.hole.visible=!1,this.bet=this.betArr[0],a=this.playSeat+n;a&&(a=a>3?a-3:a,a===Data.room.playSeat&&3!==o?this.current=Data.room.playSeat:Net.onmessage(new MessageEvent("custom",{data:{cmd:GameReturnOP.RETURN_PLAY_SEAT,playSeat:a,changePlaySeatTime:Data.room.changePlaySeatTime}})))}else this.players.forEach(function(e){return e.count=void 0}),this.hole.visible=!1,this.bet=this.betArr[0];return[2]}})})}),Notify.addNotification(Symbol["for"]("Data.room.playSeat"),function(e){return n.current=e}),Notify.addNotification(Symbol["for"]("Data.room.landlordCard"),function(e){return __awaiter(n,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=!RES.getRes("poker_json"),t?[4,RES.getResAsync("poker_json")]:[3,2];case 1:t=n.sent(),n.label=2;case 2:return this.hole.dataProvider=new eui.ArrayCollection(e),Sound.play("sound/effect/hole.mp3"),[2]}})})}),Notify.addNotification(Symbol["for"]("Data.room.balanceMap"),function(e){return __awaiter(n,void 0,void 0,function(){var t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,new Promise(function(e){var n=function(){void 0!==t.seat&&(Notify.removeNotification(Symbol["for"]("Data.time"),n),e())};Notify.addNotification(Symbol["for"]("Data.time"),n)})];case 1:return n.sent(),this.seat.showBalance&&ResultDialogUI.instance.show(e),[2]}})})}),Notify.addNotification(Symbol["for"]("Data.hand"),function(e){return __awaiter(n,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(o){switch(o.label){case 0:return t=!RES.getRes("poker_json"),t?[4,RES.getResAsync("poker_json")]:[3,2];case 1:t=o.sent(),o.label=2;case 2:return n=e.map(function(t,n){return Object.assign({mark:r.seat.landlord&&n===e.length-1},t)}),this.isInit&&n.length?(this.isInit=!1,Sound.play("sound/effect/start.mp3"),this.poker.dataProvider=new eui.ArrayCollection([]),[4,new Promise(function(e){var t=function(){n.length?(r.poker.dataProvider.addItem(n.shift()),Sound.play("sound/effect/hand.mp3")):(Notify.removeNotification(Symbol["for"]("Data.time"),t),e())};Notify.addNotification(Symbol["for"]("Data.time"),t)})]):[3,4];case 3:return o.sent(),[3,5];case 4:this.poker.dataProvider=new eui.ArrayCollection(n),o.label=5;case 5:return this.onPoker(),[2]}})})}),Notify.addNotification(Symbol["for"]("Data.cheatList"),function(e){return __awaiter(n,void 0,void 0,function(){var t,n,r,o,a,o,a;return __generator(this,function(i){switch(i.label){case 0:return t=!RES.getRes("poker_json"),t?[4,RES.getResAsync("poker_json")]:[3,2];case 1:t=i.sent(),i.label=2;case 2:for(console.log(e,"透视"),n=0;n<e.length;n++)if(r=e[n],3==r.seat)for(console.log(r,"tsleftPlayer"),this.tsleftPlayer.removeChildren(),o=0;o<r.hand.length;o++)console.log(r.hand[o],"tsleftPlayer"),a=new PokerTsUI,a.setCard(r.hand[o]),this.tsleftPlayer.addChild(a);else if(2==r.seat)for(console.log(r,"tsrightPlayer"),this.tsrightPlayer.removeChildren(),o=0;o<r.hand.length;o++)console.log(r.hand[o],"tsrightPlayer"),a=new PokerTsUI,a.setCard(r.hand[o]),this.tsrightPlayer.addChild(a);
return[2]}})})}),Notify.addNotification(Symbol["for"]("RETURN_CALL"),function(e,t){var r=n.betArr[t],o=Data.room.seatMap.find(function(t){return t.seat===e}),a=o[r.key];t||2!==a||(Net.onmessage(new MessageEvent("custom",{data:{cmd:n.betArr[1]["return"],seat:e,value:a}})),Data.room.seatMap.every(function(e){return 2===e.callLandlord})&&(n.isInit=!0,Data.autoNotify(Data.room.seatMap,Data.room.seatMap.map(function(e){return{callLandlord:0,grabLandlord:0}}),"Data.room.seatMap"))),Sound.play("sound/do/"+(2===o.player.sex?"woman":"man")+"/"+(1===a?r.source0:r.source1)+".mp3")}),Notify.addNotification(Symbol["for"]("RETURN_DO"),function(e){return __awaiter(n,void 0,void 0,function(){var t,n,r,o,a,i,s,c=this;return __generator(this,function(u){switch(u.label){case 0:return 0===e&&(MainUI.instance.inEffect=!0),[4,new Promise(function(e){var n=function(){c.players.every(function(e){return void 0!==e.index})?(Notify.removeNotification(Symbol["for"]("Data.time"),n),e()):t=!0};Notify.addNotification(Symbol["for"]("Data.time"),n)})];case 1:return u.sent(),n=Data.room.lastPlayerSeat===this.seat.seat,r=this.players.find(function(e){return e.index===Data.room.lastPlayerSeat}),(i=!!Data.room.lastPlayCard.member.length)?(s=!RES.getRes("poker_json"),s?[4,RES.getResAsync("poker_json")]:[3,3]):[3,4];case 2:s=u.sent(),u.label=3;case 3:switch(n?(this.mine.dataProvider=new eui.ArrayCollection(Data.room.lastPlayCard.member.map(function(e,t){return Object.assign({mark:c.seat.landlord&&t===Data.room.lastPlayCard.member.length-1},e)})),this.mineTxt.visible=!(this.mine.visible=!0)):(r.dataProvider=new eui.ArrayCollection(Data.room.lastPlayCard.member.map(function(e,t){return Object.assign({mark:r.host&&t===Data.room.lastPlayCard.member.length-1},e)})),r.txt=void 0),Sound.play("sound/effect/do.mp3"),Data.room.lastPlayCard.type){case 1:o="s"+Data.room.lastPlayCard.member[0].value;break;case 3:o="d"+Data.room.lastPlayCard.member[0].value;break;case 6:case 12:o="11";break;default:o=""+Data.room.lastPlayCard.type}return Data.room.lastPlayCard.type===this.lastPlayer.type&&Data.room.lastPlayerSeat!==this.lastPlayer.seat&&(a=Math.floor(Math.random()*(isNaN(parseInt(o,10))?3:4)),3!==a&&(o="bigger"+a)),[3,5];case 4:n?(this.mineTxt.source="txt_bcz",this.mine.visible=!(this.mineTxt.visible=!0)):(r.txt="txt_bcz",r.dataProvider=null),o="pass"+Math.floor(3*Math.random()),u.label=5;case 5:return this.lastPlayer={seat:Data.room.lastPlayerSeat,type:Data.room.lastPlayCard.type},t&&(this.current=Data.room.playSeat),-1!==["11","13","14"].indexOf(o)&&Sound.play("sound/effect/"+o+".mp3"),[4,Sound.play("sound/do/"+(2===r.sex?"woman":"man")+"/"+o+".mp3")];case 6:return u.sent().once(egret.Event.SOUND_COMPLETE,function(){i&&3>e&&(o=0===e?Data.room.seatMap.every(function(e){return e.landlord||17===e.handSize})?"spring":void 0:"l"+e,o?Sound.play("sound/do/"+(2===r.sex?"woman":"man")+"/"+o+".mp3"):MainUI.instance.inEffect=!1,-1!==["spring","gnirps"].indexOf(o)&&MainUI.instance.playEffect(o))},this),-1!==["2","4","11","13","14"].indexOf(o)&&MainUI.instance.playEffect(o),[2]}})})}),this.share.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return ShareUI.instance.show("share")},this),this.ready.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(n,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=!this.seat.ready,[4,Net.sendString(SelfOP.SELF_READY,{ready:e})];case 1:return t.sent().errorCode||Net.onmessage(new MessageEvent("custom",{data:{cmd:GameReturnOP.RETURN_READY,seat:this.seat.seat,ready:e}})),[2]}})})},this),this.betGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){return __awaiter(n,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=this.betGroup.getChildIndex(e.target)+1,[4,Net.sendString(this.bet.opcode,{type:t})];case 1:return n.sent().errorCode||Net.onmessage(new MessageEvent("custom",{data:{cmd:this.bet["return"],seat:this.seat.seat,value:t}})),[2]}})})},this),this.poker.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return t.target instanceof e.PokerItemUI&&n.onPoker(t.target)},this),this.poker.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){return t.target instanceof e.PokerItemUI&&n.selected!==t.target.itemIndex&&n.onPoker(t.target)},this),this.pass.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return n.doPoker([])},this),this.hint.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.seat.tip[n.lastTip=n.lastTip+1===n.seat.tip.length?0:n.lastTip+1].member;n.pokers.forEach(function(t){return t.chosen=e.some(function(e){return e.type===t.data.type&&e.value===t.data.value})}),n.onPoker()},this),this["do"].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return n.doPoker(n.selectedList)},this),this.players=[this.me,this.leftPlayer,this.rightPlayer]},n}(eui.Component);e.GameUI=t,__reflect(t.prototype,"component.GameUI")}(component||(component={}));var GameService=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.getInstance(this)},enumerable:!0,configurable:!0}),t.prototype.onMessage=function(e,t,n){if(!(t instanceof DataView))switch(console.log(t),e){case GameReturnOP.RETURN_CHAT:MainUI.instance.playChat(t);break;case GameReturnOP.RETURN_SEAT_INFO:Data.autoNotify(Data.room.seatMap,Data.room.seatMap.find(function(e){return e.seat===t.seatInfo.seat})?Data.room.seatMap.map(function(e){return e.seat===t.seatInfo.seat?t.seatInfo:e}):Data.room.seatMap.concat([t.seatInfo]),"Data.room.seatMap");break;case GameReturnOP.RETURN_READY:Data.autoNotify(Data.room.seatMap,Data.room.seatMap.map(function(e){return e.seat===t.seat?{ready:t.ready}:e}),"Data.room.seatMap");break;case GameReturnOP.RETURN_HAND:Data.hand=Data.autoNotify(Data.hand,t.hand,"Data.hand").result;break;case GameReturnOP.RETURN_TS:console.log("透视",t.cheatList),Data.cheatList=Data.autoNotify(Data.cheatList,t.cheatList,"Data.cheatList").result;break;case GameReturnOP.RETURN_PLAY_SEAT:Data.autoNotify(Data.room,{playSeat:t.playSeat,changePlaySeatTime:t.changePlaySeatTime},"Data.room"),"custom"!==n&&(MainUI.instance.playSeat=t.playSeat),t.tip&&Data.autoNotify(Data.room.seatMap,Data.room.seatMap.map(function(e){return e.seat===t.playSeat?{canPass:t.canPass,tip:t.tip}:e}),"Data.room.seatMap");break;case GameReturnOP.RETURN_CALL:Data.autoNotify(Data.room.seatMap,Data.room.seatMap.map(function(e){return e.seat===t.seat?{callLandlord:t.call||t.value}:e}),"Data.room.seatMap"),Notify.sendNotification(Symbol["for"]("RETURN_CALL"),!0,t.seat,0);break;case GameReturnOP.RETURN_DO:if(console.log("透视出牌",Data.cheatList),console.log("透视出牌",Data.cheatList.length),Data.cheatList.length>0){for(var r=Data.cheatList,o=0;o<r.length;o++)if(console.log("seat",t.seat,r[o].seat),r[o].seat==t.seat)for(var a=t.segment.member,i=0;i<a.length;i++)for(var s=0;s<r[o].hand.length;s++)a[i].type!=r[o].hand[s].type||a[i].value!=r[o].hand[s].value||r[o].hand.splice(s,1);Data.cheatList=Data.autoNotify(Data.cheatList,r,"Data.cheatList").result,Notify.sendNotification(Symbol["for"]("Data.cheatList"),!0,Data.cheatList)}Data.autoNotify(Data.room,{lastPlayerSeat:t.seat,lastPlayCard:t.segment,seatMap:Data.room.seatMap.map(function(e){return e.seat===t.seat?{handSize:t.handSize}:e})},"Data.room"),Notify.sendNotification(Symbol["for"]("RETURN_DO"),!0,t.handSize);break;case GameReturnOP.RETURN_RESULT:Data.autoNotify(Data.room,{playSeat:0,seatMap:Data.room.seatMap.map(function(e){return e.seat===MainUI.instance.seat.seat?{showBalance:!0}:e}),balanceMap:Object.keys(t.balance).map(function(e){return Object.assign({seat:parseInt(e,10)},t.balance[e])})},"Data.room");break;case GameReturnOP.RETURN_EXIT:Data.autoNotify(Data.room,{seatMap:Data.copy(Data.room.seatMap).filter(function(e){return e.seat!==t.seat})},"Data.room");break;case GameReturnOP.RETURN_DISS:DissolutionDialogUI.instance.currentState="progressing",DissolutionDialogUI.instance.startTime=t.dissolveRoomTime,Main.instance.addChild(DissolutionDialogUI.instance);break;case GameReturnOP.RETURN_REPLY_DISS:Data.autoNotify(Data.room,{dissolveMap:Object.keys(t.dissolveMap).map(function(e){return{seat:parseInt(e,10),agree:t.dissolveMap[e]}})},"Data.room");break;case GameReturnOP.RETURN_HOST:Data.autoNotify(Data.room,{landlordSeat:t.seat,landlordCard:t.landlordCard,seatMap:Data.room.seatMap.map(function(e){var n=e.seat===t.seat;return{landlord:n,handSize:n?20:17}})},"Data.room");break;case GameReturnOP.RETURN_ONLINE:Data.autoNotify(Data.room.seatMap,Data.room.seatMap.map(function(e){return e.seat===t.seat?{player:{active:t.online}}:e}),"Data.room.seatMap");break;case GameReturnOP.RETURN_RECALL:Data.autoNotify(Data.room.seatMap,Data.room.seatMap.map(function(e){return e.seat===t.seat?{grabLandlord:t.grab||t.value}:e}),"Data.room.seatMap"),Notify.sendNotification(Symbol["for"]("RETURN_CALL"),!0,t.seat,1);break;case GameReturnOP.RETURN_DOUBLE:Data.autoNotify(Data.room.seatMap,Data.room.seatMap.map(function(e){return e.seat===t.seat?{toDouble:t["double"]||t.value}:e}),"Data.room.seatMap"),Notify.sendNotification(Symbol["for"]("RETURN_CALL"),!0,t.seat,2);break;case GameReturnOP.RETURN_ROUND:Data.autoNotify(Data.room,{round:t.round},"Data.room")}},t}(ServiceBase);__reflect(GameService.prototype,"GameService");var component;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mc=new egret.MovieClip,t.chatCount=0,t.playExpression=function(e){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=this.mc,[4,Main.mcFactory];case 1:return t.movieClipData=n.sent().generateMovieClipData("e"+e+"g"),this.mc.visible=!0,this.mc.gotoAndPlay(0,Math.round(3*this.mc.frameRate/this.mc.totalFrames)),[2]}})})},t.playChat=function(e){return __awaiter(t,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(o){switch(o.label){case 0:t=function(){0===--r.chatCount&&(r.chatGroup.visible=!1)},this.chat.text=Sound.chatList[e],this.chatGroup.visible=!0,this.chatCount++,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Sound.play("sound/chat/"+(2===this.sex?"woman":"man")+"/"+e+".mp3")];case 2:return o.sent().once(egret.Event.SOUND_COMPLETE,t,this),[3,4];case 3:return n=o.sent(),t(),[3,4];case 4:return[2]}})})},t}return __extends(t,e),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},set:function(e){this._index=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"head",{get:function(){return this._head},set:function(e){this._head=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uname",{get:function(){return Txt.overflow(this._uname,12)},set:function(e){this._uname=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sex",{get:function(){return this._sex},set:function(e){this._sex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){return this._score},set:function(e){this._score=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},set:function(e){this._host=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offline",{get:function(){return this._offline},set:function(e){this._offline=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"txt",{get:function(){return this._txt},set:function(e){this._txt=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},set:function(e){this._current=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showCount",{get:function(){return this._showCount},set:function(e){this._showCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},set:function(e){this._startTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this._count},set:function(e){this._count=new eui.ArrayCollection((""+(void 0===e?"":e)).split("")),this.showCount=!(!this._count||!this._count.length)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataProvider",{get:function(){return this._dataProvider},set:function(e){this._dataProvider=e},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return e.prototype.childrenCreated.call(this),egret.Tween.get(this.shine,{loop:!0}).to({alpha:0},300).to({alpha:1},300),this.gif.addChild(this.mc),this.mc.addEventListener(egret.Event.COMPLETE,function(){t.mc.visible=!1},this),this.btn_invite.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return ShareUI.instance.show("share")},this),[2]})})},t}(eui.Component);e.PlayerUI=t,__reflect(t.prototype,"component.PlayerUI")}(component||(component={}));var component;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type_m",{get:function(){return this._type_m},set:function(e){this._type_m=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mark",{get:function(){return this._mark},set:function(e){this._mark=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chosen",{get:function(){return this.selected},set:function(e){this.selected!==e&&(this.selected=e,Sound.play("sound/effect/poker.mp3"))},enumerable:!0,configurable:!0}),t.prototype.getCurrentState=function(){return this.selected?"down":"up"},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.data.type>0?(this.type_m=this.type=""+this.data.type,this.value=""+(this.data.type%2===0?"h":"r")+this.data.value,this.data.value>10&&(this.type=this.data.type+"_"+this.data.value)):(this.type=this.data.type+"_"+this.data.value,this.value=""+(this.data.value%2===0?"h":"r")+this.data.value),this.mark=this.data.mark},t}(eui.ItemRenderer);e.PokerItemUI=t,__reflect(t.prototype,"component.PokerItemUI")}(component||(component={}));var Entity;!function(e){var t=function(){function e(){}return e}();e.Player=t,__reflect(t.prototype,"Entity.Player");var n=function(){function e(){}return e}();e.Poker=n,__reflect(n.prototype,"Entity.Poker");var r=function(){function e(){}return e}();e.Seat=r,__reflect(r.prototype,"Entity.Seat");var o=function(){function e(){}return e}();e.Balance=o,__reflect(o.prototype,"Entity.Balance");var a=function(){function e(){}return e}();e.Dissolve=a,__reflect(a.prototype,"Entity.Dissolve");var i=function(){function e(){}return e}();e.Room=i,__reflect(i.prototype,"Entity.Room");var s=function(){function e(){}return e}();e.Bet=s,__reflect(s.prototype,"Entity.Bet")}(Entity||(Entity={}));var component;!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n.alpha=0,n.horizontalCenter=0,n.verticalCenter=100,n.text=t,n.addEventListener(egret.Event.ADDED_TO_STAGE,function(){egret.Tween.get(n).to({alpha:1,verticalCenter:0},300,egret.Ease.backOut).wait(1400).to({alpha:0,verticalCenter:-100},300,egret.Ease.backIn).call(function(){return Main.instance.removeChild(n)})},n),Main.instance.addChild(n),n}return __extends(t,e),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e},enumerable:!0,configurable:!0}),t}(eui.Component);e.ToastUI=t,__reflect(t.prototype,"component.ToastUI")}(component||(component={}));var ChatDialogUI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.getInstance(this)},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,o,a,i,s=this;return __generator(this,function(c){switch(c.label){case 0:return e.prototype.childrenCreated.call(this),this.list.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){e.target instanceof eui.ItemRenderer&&(Net.sendString(GameSendOP.SEND_CHAT,{seat:MainUI.instance.seat.seat,chat:e.target.itemIndex}),s.dialog.close())},this),this.expression.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){e.target instanceof eui.ItemRenderer&&(Net.sendString(GameSendOP.SEND_CHAT,{seat:MainUI.instance.seat.seat,expression:e.target.itemIndex}),s.dialog.close())},this),this.list.dataProvider=new eui.ArrayCollection(Sound.chatList),t=this.expression,r=(n=eui.ArrayCollection).bind,a=(o=Object).keys,i=RES.getRes("expression_json"),i?[3,2]:[4,RES.getResAsync("expression_json")];case 1:i=c.sent(),c.label=2;case 2:return t.dataProvider=new(r.apply(n,[void 0,a.apply(o,[i._textureMap])])),[2]}})})},t}(UIBase);__reflect(ChatDialogUI.prototype,"ChatDialogUI");var DissolutionDialogUI=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.reply=function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Net.sendString(SelfOP.SELF_REPLY_DISS,{agree:e})];case 1:return t.sent().errorCode||(this.currentState="waiting"),[2]}})})},t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.getInstance(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},set:function(e){this._startTime=e},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),Notify.addNotification(Symbol["for"]("Data.time"),function(e){if(t.startTime){var n=100*(1-(e-t.startTime)/3e4);n>=0&&"reject"!==t.currentState?t.progress.percentWidth=n:(t.progress.percentWidth=0,t.startTime=0)}}),Notify.addNotification(Symbol["for"]("Data.room.dissolveMap"),function(e){var n=Data.room.seatMap.map(function(t){var n=e.find(function(e){return e&&e.seat===t.seat});return{headImgUrl:t.player.headImgUrl,nickname:Txt.overflow(t.player.nickname,12),state:void 0===n?"":n.agree?"o":"x"}});n.find(function(e){return"x"===e.state})?(t.currentState="reject",Time.setTimeout(function(){return t.dialog.forceClose()},3e3)):n.every(function(e){return"o"===e.state})&&Net.postMessage({forLobby:!0,cmd:"close"});var r=0;n.forEach(function(e){"o"==e.state&&r++},t),t.txt_who.text="某玩家申请立即解散牌局",t.txt_cur_total.textFlow=[{text:r+"/"+n.length,style:{size:44}},{text:"人",style:{size:32}}],t.players&&(t.players.dataProvider=new eui.ArrayCollection(n))}),this.cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.dialog.forceClose()},this),this.ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Net.sendString(SelfOP.SELF_DISS,{})];case 1:return e.sent().errorCode||(this.currentState="waiting",this.startTime=Data.time),[2]}})})},this),this.reject.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.reply(!1)},this),this.agree.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.reply(!0)},this)},t}(UIBase);__reflect(DissolutionDialogUI.prototype,"DissolutionDialogUI");var MessageDialogUI=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.show=function(e){Time.clearTimeout(t.timeout),t.dialog&&t.dialog.init(),t.text=e.text,t.title=e.title||"",t.state=void 0===e.state?"normal":e.state,t.canBack=void 0===e.canBack?!0:e.canBack,t.canClose=void 0===e.canClose?!0:e.canClose,t.onClose=e.onClose,e.autoHide>0&&(t.timeout=Time.setTimeout(function(){return t.close()},e.autoHide)),Main.instance.addChild(t)},t.showHint=function(e,n){t.show({text:e,autoHide:void 0===n?3e3:n})},t.showLoading=function(e){t.show({text:e,state:"loading",canBack:!1,canClose:!1})},t.showAlert=function(e,n,r){void 0===r&&(r="alert"),t.show({text:e,state:r,canBack:!1,canClose:!1,onClose:n})},t.showConfirm=function(e,n){t.showAlert(e,n,"confirm")},t.close=function(){t.parent&&t.dialog&&t.dialog.forceClose()},t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.getInstance(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this._title},set:function(e){this._title=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canBack",{get:function(){return this._canBack},set:function(e){this._canBack=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canClose",{get:function(){return this._canClose},set:function(e){this._canClose=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onClose",{get:function(){return this._onClose},set:function(e){this._onClose=e},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),egret.Tween.get(this.loading,{loop:!0}).to({rotation:360},500),this.cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onClose=void 0,t.close()},this),this.ok.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},t}(UIBase);__reflect(MessageDialogUI.prototype,"MessageDialogUI");var ResultDialogUI=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._fast={real:void 0,not:void 0},t.show=function(e){return __awaiter(t,void 0,void 0,function(){var t,n=this;return __generator(this,function(r){switch(r.label){case 0:return[4,new Promise(function(e){var t=function(){MainUI.instance.inEffect||(Notify.removeNotification(Symbol["for"]("Data.time"),t),e())};Notify.addNotification(Symbol["for"]("Data.time"),t)})];case 1:return r.sent(),t=e.find(function(e){return e.seat===MainUI.instance.seat.seat}),this.currentState=""+(Data.room.round<Data.room.totalRound?"single":"total"),this.fast=2===Data.room.roomType,this.totalScore=t.totalScore,this.desc=e.map(function(e,t){return Txt.overflow(Data.room.seatMap.find(function(t){return t.seat===e.seat}).player.nickname,12)+"："+e.totalScore+(t%2===0?"　":"\r\n")}).join(""),this.roomId=""+params.roomId,this.round=Data.room.round+"/"+Data.room.totalRound,this.dataProvider=new eui.ArrayCollection(e.sort(function(e,t){return t.totalScore-e.totalScore}).map(function(e,t){var r=Data.room.seatMap.find(function(t){return t.seat===e.seat});return{showNick:"single"==n.currentState?300:480,showCenter:"single"==n.currentState?!0:!1,state:0===t?"winner":"loser",headImgUrl:r.player.headImgUrl,nickname:Txt.overflow(r.player.nickname+"",7),totalScore:e.totalScore<0?e.totalScore:"+"+e.totalScore,txtColer:e.totalScore<0?"0xff4a4a":"0xa8e03b",prop:new eui.ArrayCollection([{key:"胜利局数",value:e.winRound},{key:"失败局数",value:e.loseRound},{key:"本局得分",value:e.score}])}})),Main.instance.addChild(this),[4,Sound.play("sound/effect/result.mp3")];case 2:return r.sent().once(egret.Event.SOUND_COMPLETE,function(){return Sound.play("sound/effect/"+(Data.room.round<Data.room.totalRound?t.win?"win":"lose":"over")+".mp3")},this),[2]}})})},t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.getInstance(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"roomId",{get:function(){return this._roomId},set:function(e){this._roomId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"round",{get:function(){return this._round},set:function(e){this._round=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fast",{get:function(){return this._fast},set:function(e){this._fast.not=!(this._fast.real=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataProvider",{get:function(){return this._dataProvider},set:function(e){this._dataProvider=e},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this["continue"].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.dialog.forceClose()},this),this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Net.postMessage({forLobby:!0,cmd:"close"})},this),this.share.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){WeChat.initShare({title:(t.totalScore>=0?"我在{platform}斗地主赢了"+t.totalScore+"分":"我刚玩了{platform}斗地主，很不错")+"，你想一起来么？",desc:t.desc}),ShareUI.instance.show("share")},this),this.dialog.onClose=function(){return MainUI.instance.init(!0)}},t}(UIBase);__reflect(ResultDialogUI.prototype,"ResultDialogUI");var RuleDialogUI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.getInstance(this)},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){},Object.defineProperty(t.prototype,"rule",{get:function(){return(new egret.HtmlTextParser).parse(['<b><font size="34">【发牌】</font></b>\n',"\n","　　一副牌 54 张，一人 17 张，留 3 张做底牌，在确定地主之前玩家不能看底牌。\n","\n","\n",'<b><font size="34">【叫牌】</font></b>\n',"\n",'　　叫牌按出牌的顺序轮流进行，叫牌时可以选择 "叫地主 " 、" 不叫 " 。如果有玩家选择 "叫地主 " 则立即结束叫牌，该玩家为地主；如果都"不叫"，则重新发牌，重新叫牌，直到有人"叫地主"为止 。\n',"\n","\n",'<b><font size="34">【第一个叫牌的玩家】</font></b>\n',"\n","　　1 、第一轮叫牌的玩家由系统随机选定。\n",'　　2 、如果有玩家在叫牌前选择"明牌"，则第一个选择"明牌"的玩家优先获得叫牌权。\n','　　3 、如果有玩家在叫牌前选择"明牌"，且三名玩家都不选择"叫地主"，则系统选择第一个"明牌"的玩家为地主。\n',"\n","\n",'<b><font size="34">【抢地主】</font></b>\n',"\n",'　　1 、当某位玩家叫完地主后，按照次序每位玩家均有且只有一次"抢地主"的机会。玩家选择"抢地主"后，如果没有其他玩家继续"抢地主"则地主权利属于该名"抢地主"的玩家。\n','　　2 、如果没有任何玩家选择"抢地主"，则地主权利属于"叫地主"的玩家。\n','　　3 、每"抢地主"一次，游戏倍数 *2 。\n','　　4 、凡是有过"不叫地主"操作的玩家无法进行"抢地主"的操作。\n',"\n","\n",'<b><font size="34">【明牌】</font></b>\n',"\n",'　　1 、明牌为亮明手上所有牌进行游戏，主要分为三种："明牌开始"、"发牌明牌"、"明牌"。\n',"　　2 、明牌开始：在还没发牌时，就选择明牌并保持开始游戏，游戏倍数 *5 。\n","　　3 、发牌明牌：在发牌的过程中选择明牌游戏，根据发牌数量的多少游戏倍数 *4 和 *3 。\n","　　4 、明牌：在收完三张底牌后可以选择明牌并开始游戏，游戏倍数 *2 。\n",'　　5 、若同时有多名玩家选择"明牌"则按照最大的明牌倍数计算。\n',"\n","\n",'<b><font size="34">【加倍】</font></b>\n',"\n","　　1、在选择抢完地主后，地主出牌前增加一个翻倍选择功能。在抢完地主后地主把底牌拿到手中，出现翻倍选择功能，用户可以选择加倍或不加倍。但若要进行加倍操作时，玩家必须符合特定条件。\n","　　2、在限制时间内完成加倍或不加倍的操作后，必须等待其他玩家进行完相关操作或直到限制时间到，则游戏开始由地主出牌。\n","　　3、加倍后游戏得分计算为：倍数*每分对应欢乐豆关系*自己加倍数*对手加倍数，若有加倍则*2，若没加倍则*1。\n","　　4、加倍条件为规定的用户欢乐豆数量超过该房间规定的值即可。\n","　　5、规定对象如下：1、加倍用户为地主时，必须全部玩家的欢乐豆数量全部超过房间规定数值。2、加倍用户为农民时，必须自己和地主玩家的欢乐豆数量全部超过房间规定数值。\n","\n","\n",'<b><font size="34">【出牌】</font></b>\n',"\n",'　　将三张底牌交给地主，并亮出底牌让所有人都能看到。地主首先出牌，然后按逆时针顺序依次出牌，轮到用户跟牌时，用户可以选择 " 不出 " 或出比上一个玩家大的牌。某一玩家出完牌时结束本盘。\n',"\n","\n",'<b><font size="34">【牌型】</font></b>\n',"\n","　　火箭：即双王（大王和小王），最大的牌。\n","　　炸弹：四张同数值牌（如四个 7 ）。\n","　　单牌：单个牌（如红桃 5 ）。\n","　　对牌：数值相同的两张牌（如梅花 4+ 方块 4 ）。\n","　　三张牌：数值相同的三张牌（如三个 J ）。\n","　　三带一：数值相同的三张牌 + 一张单牌或一对牌。例如： 333+6 或 444+99\n","　　单顺：五张或更多的连续单牌（如： 45678 或 78910JQK ）。不包括 2 点和双王。\n","　　双顺：三对或更多的连续对牌（如： 334455 、 7788991010JJ ）。不包括 2 点和双王。\n","　　三顺：二个或更多的连续三张牌（如： 333444 、 555666777888 ）。不包括 2 点和双王。\n","　　飞机带翅膀：三顺+同数量的单牌（或同数量的对牌）。\n","　　如： 444555+79 或 333444555+7799JJ\n","　　四带二：四张牌+两手牌。（注意：四带二不是炸弹）。\n","　　如： 5555 + 3 + 8 或 4444 + 55 + 77 。"].join(""))},enumerable:!0,configurable:!0}),t}(UIBase);__reflect(RuleDialogUI.prototype,"RuleDialogUI");var SettingDialogUI=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,function(){t.music.selected=Sound.music,t.effect.selected=Sound.effect},t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.getInstance(this)},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.music.addEventListener(egret.Event.CHANGE,function(){return Sound.toggle(t.music.selected,egret.Sound.MUSIC)},this),this.effect.addEventListener(egret.Event.CHANGE,function(){return Sound.toggle(t.effect.selected)},this)},t}(UIBase);__reflect(SettingDialogUI.prototype,"SettingDialogUI");var Adapter;!function(e){var t=["lnull"],n=function(){function e(){}return e.prototype.getAsset=function(e,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(o){switch(o.label){case 0:return-1!==t.indexOf(e)?[3,6]:RES.hasRes(e)?(r=RES.getRes(e),r?[3,2]:[4,RES.getResAsync(e)]):[3,3];case 1:r=o.sent(),o.label=2;case 2:return[3,5];case 3:return[4,Main.res.getResByUrl(e,null,null,RES.ResourceItem.TYPE_IMAGE)];case 4:r=o.sent(),o.label=5;case 5:return[3,7];case 6:r=null,o.label=7;case 7:return n(r,e),[2]}})})},e}();e.AssetAdapter=n,__reflect(n.prototype,"Adapter.AssetAdapter",["eui.IAssetAdapter"]);var r=function(){function e(){}return e.prototype.getTheme=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,o;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,Main.res.getResByUrl(""+params.oss+e+"?v="+version,null,null,RES.ResourceItem.TYPE_TEXT)];case 1:return r=a.sent(),[3,3];case 2:return o=a.sent(),n(o),[3,3];case 3:return t(r),[2]}})})},e}();e.ThemeAdapter=r,__reflect(r.prototype,"Adapter.ThemeAdapter",["eui.IThemeAdapter"])}(Adapter||(Adapter={}));var Net;!function(e){var t=new Map,n=function(e){return-1!==Object.keys(SelfOP).indexOf(""+e)};e.onmessage=function(e){var r,o;return e.data instanceof ArrayBuffer?(r=new DataView(e.data),o=r.getUint16(0)):(r=e.data,o=r.cmd),n(o)?void Notify.sendNotification(t.get(o),!0,r,e.type):void ServiceBase.onMessage(o,r,e.type)},e.sendJSON=function(r,o,a,i){return new Promise(function(s,c){var u,l;try{l=JSON.stringify(Object.assign({cmd:r},o))}catch(f){return void c(new Error("非法数据"))}if(n(r)&&(a||i)){var d=Symbol["for"]("SelfOP_"+r);if(t.has(r))return void c(new Error("请勿频繁操作"));var h,p,m=Time.setTimeout(function(){p=!0,MessageDialogUI.instance.showLoading("操作中…")},500),g=Time.setTimeout(function(){Time.clearTimeout(m),Notify.removeNotification(d,h),t["delete"](r),p&&MessageDialogUI.instance.close(),c(new Error("请求超时"))},1e4);t.set(r,d),h=i?function(e){Time.clearTimeout(g),Time.clearTimeout(m),t["delete"](r),p&&MessageDialogUI.instance.close(),s(e)}:function(e){Time.clearTimeout(g),Time.clearTimeout(m),t["delete"](r),p&&MessageDialogUI.instance.close(),s(ServiceBase.getData(a,e))},Notify.addNotification(d,h,!0)}else s();i?e.postMessage(l):(u=bufferify.encode(2,o),u.setUint16(0,r),e.postMessage(u))})},e.sendString=function(t,n){return e.sendJSON(t,n,null,!0)},e.postMessage=function(e){window.parent.postMessage(e,"*")},e.onPostMessage=function(t){switch(t.cmd){case"ready":window.dispatchEvent(new Event("resize")),Data.time=t.time,MainUI.instance.init();break;case"offline":MessageDialogUI.instance.showAlert("连接已断开，点击确定重新登录",function(){e.postMessage({forLobby:!0,cmd:"refresh"})});break;case"shareSuccess":break;case"shareFail":break;case"shareCancel":break;case"startRecordSuccess":break;case"startRecordFail":break;case"stopRecordSuccess":t.localId;break;case"stopRecordFail":break;case"uploadVoiceSuccess":e.sendString(GameSendOP.SEND_CHAT,{seat:MainUI.instance.seat.seat,serverId:t.serverId});break;case"uploadVoiceFail":break;case"downloadVoiceSuccess":t.localId;break;case"downloadVoiceFail":break;case"playVoiceSuccess":break;case"playVoiceFail":break;case"stopVoiceSuccess":t.localId;break;case"stopVoiceFail":}}}(Net||(Net={}));var Notify;!function(e){var t=new Map,n=new Map;e.addNotification=function(e,t,r){void 0===r&&(r=!1);var o=n.get(e);o||(o=[],n.set(e,o)),o.some(function(e){return e.callback===t})||o.push({callback:t,isOnce:r})},e.removeNotification=function(e,t){var r=n.get(e);r&&r.some(function(e,n){return e.callback===t&&!!r.splice(n,1)
})},e.sendNotification=function(r,o){void 0===o&&(o=!0);for(var a=[],i=2;i<arguments.length;i++)a[i-2]=arguments[i];var s=n.get(r),c=function(){Object.assign([],s).forEach(function(t){t.isOnce&&e.removeNotification(r,t.callback),t.callback.apply(t,a)})};s&&(o?c():(t.has(r)&&(Time.clearTimeout(t.get(r)),t["delete"](r)),t.set(r,Time.setTimeout(c,300))))},e.hasNotification=function(e,t){var r=n.get(e);return r?r.some(function(e,n){return e.callback===t}):!1}}(Notify||(Notify={}));var Processor;!function(e){var t=function(){function e(){this.typeMap=new Map([["jpg","image"],["png","image"],["webp","image"],["json","json"],["fnt","font"],["pvr","pvr"],["mp3","sound"],["dbmv","bin"]])}return e.prototype.getType=function(e){var t=this.typeMap.get(e.url.substr(e.url.lastIndexOf(".")+1));return"json"===t&&(-1!==e.url.indexOf("sheet")?t="sheet":-1!==e.url.indexOf("movieclip")&&(t="movieclip")),t},e.prototype.onLoadStart=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return t.type=this.getType(t),t.url=t.url+"?v="+version,[2,RES.processor.isSupport(t).onLoadStart(e,t)]})})},e.prototype.onRemoveStart=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,RES.processor.isSupport(t).onRemoveStart(e,t)]})})},e.prototype.getData=function(e,t,n,r){return RES.processor.isSupport(t).getData(e,t,n,r)},e}();e.versionProcessor=t,__reflect(t.prototype,"Processor.versionProcessor",["RES.processor.Processor"]);var n=function(){function e(){}return e.prototype.onLoadStart=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return t.url=t.url+"?v="+version,[2,RES.processor.SheetProcessor.onLoadStart(e,t)]})})},e.prototype.onRemoveStart=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,RES.processor.SheetProcessor.onRemoveStart(e,t)]})})},e.prototype.getData=function(e,t,n,r){return RES.processor.SheetProcessor.getData(e,t,n,r)},e}();e.sheetProcessor=n,__reflect(n.prototype,"Processor.sheetProcessor",["RES.processor.Processor"])}(Processor||(Processor={}));var Sound;!function(e){var t=this,n=new Map,r="-ddz";e.music="true"===localStorage.getItem("music"+r),e.effect="false"!==localStorage.getItem("effect"+r);var o=function(){function e(e){this.channel=e}return Object.defineProperty(e.prototype,"volume",{get:function(){return this.channel.volume},set:function(e){try{this.channel.volume=e}catch(t){console.log(t)}},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this.channel.stop()},e.prototype.once=function(e,t,n,r,o){this.channel.once(e,t,n,r,o)},e.prototype.dispatchEvent=function(e){return this.channel.dispatchEvent(e)},e}();__reflect(o.prototype,"SoundChannel"),e.chatList=["大家好，很高兴见到各位！","快点吧，我等到花儿都谢了。","不要走，决战到天亮。","你是帅哥还是美女？","君子报仇，十盘不算晚。","打错了，呜呜呜呜。"],e.play=function(r,a,i){return void 0===a&&(a=1),void 0===i&&(i=egret.Sound.EFFECT),new Promise(function(s,c){return __awaiter(t,void 0,void 0,function(){var t,u;return __generator(this,function(l){switch(l.label){case 0:return t=RES.getRes(r),t?[3,2]:[4,RES.getResAsync(r)];case 1:t=l.sent(),l.label=2;case 2:return t?(t.type=i,u=new o(t.play(0,a)),u.volume=(i===egret.Sound.MUSIC?e.music:e.effect)?1:0,u.once(egret.Event.SOUND_COMPLETE,function(){return n["delete"](u)},null),n.set(u,t),s(u)):c(new Error("数据源 '"+r+"' 无效")),[2]}})})})},e.toggle=function(t,o){void 0===o&&(o=egret.Sound.EFFECT),o===egret.Sound.MUSIC?(e.music=t,localStorage.setItem("music"+r,""+t)):(e.effect=t,localStorage.setItem("effect"+r,""+t)),n.forEach(function(e,n){o===e.type&&egret.Tween.get(n).to({volume:t?1:0},300)})}}(Sound||(Sound={}));var Time;!function(e){var t=new Map,n=[],r=[],o=[];e.run=function(){e.startTick(Symbol["for"]("Time.run"),function(e){return Data.tick(e),!0})},e.reBoot=function(){t.forEach(function(t){return egret.stopTick(t,e)}),n.forEach(function(e){return e.stop()}),r.forEach(function(e){return window.clearTimeout(e)}),o.forEach(function(e){return window.clearInterval(e)}),t.clear(),n.splice(0),r.splice(0),o.splice(0)},e.startTick=function(n,r){var o=function(e){return r(e)};t.has(n)||(egret.startTick(o,e),t.set(n,o))},e.stopTick=function(n){var r=t.get(n);r&&egret.stopTick(r,e),t["delete"](n)},e.Timer=function(e,t){var r=new egret.Timer(e,t);return n.push(r),r},e.setTimeout=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var a=window.setTimeout(e,t,n);return r.push(a),a},e.clearTimeout=function(e){var t=r.indexOf(e);-1!==t&&r.splice(t,1),window.clearTimeout(e)},e.setInterval=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var a=window.setInterval(e,t,n);return o.push(a),a},e.clearInterval=function(e){var t=o.indexOf(e);-1!==t&&o.splice(t,1),window.clearInterval(e)},e.format=function(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};return/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(""+e.getFullYear()).substr(4-RegExp.$1.length))),Object.keys(n).forEach(function(e){new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?n[e]:("00"+n[e]).substr((""+n[e]).length)))}),t},e.diff=function(e,t){var n,r,o=t-e,a=o%864e5,i=Math.floor(o/864e5),s=Math.floor(a/36e5);return a%=36e5,n=Math.floor(a/6e4),r=Math.round(a%6e4/1e3),""+(i?i+"天 ":"")+(10>s?"0":"")+s+":"+(10>n?"0":"")+n+":"+(10>r?"0":"")+r}}(Time||(Time={}));var Txt;!function(e){e.overflow=function(e,t){if(void 0!==e){for(var n;e.split("").map(function(e){return/[\u0000-\u00FF]/.test(e)?1:2}).reduce(function(e,t){return e+t})>t;)e=e.substring(0,e.length-1),n=!0;return""+(n?e.substring(0,e.length-1)+"…":e)}},e.limitNum=function(e){var t=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)};return e>99999?(e*=1e-4,e>999.9999?e>9999.9999?(e*=1e-4,t(e,2)+"亿"):t(e,1)+"万":t(e,2)+"万"):""+e}}(Txt||(Txt={}));var WeChat;!function(e){var t,n=this;e.initShare=function(e){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,new Promise(function(e){var t=function(){Data.room&&void 0!==Data.room.aa&&(Notify.removeNotification(Symbol["for"]("Data.time"),t),e())};Notify.addNotification(Symbol["for"]("Data.time"),t)})];case 1:return t.sent(),Net.postMessage(Object.assign({forLobby:!0,cmd:"wx",func:"initShare",title:"{platform}-斗地主"+(2===Data.room.roomType?"":"，房间号为"+params.roomId),desc:"局数："+Data.room.totalRound+"局\r\n扣费方式："+(Data.room.aa?"AA制":"房主付费")},e)),[2]}})})},e.startRecord=function(){t=Data.time,Net.postMessage({forLobby:!0,cmd:"wx",func:"startRecord"})},e.stopRecord=function(e){void 0===e&&(e=1),e=Data.time-t<1e3?0:e,Net.postMessage({forLobby:!0,cmd:"wx",func:"stopRecord",type:e}),e&&Sound.play("sound/effect/voice.mp3")},e.downloadVoice=function(e){Net.postMessage({forLobby:!0,cmd:"wx",func:"downloadVoice",serverId:e})}}(WeChat||(WeChat={}));